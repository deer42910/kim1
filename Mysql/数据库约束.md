数据库约束

1. 域（列）级约束 

2. > 当前列值

   非空约束：NOT NULL

   默认值约束：DEFAULT   不能添加到唯一或主键上

   检查约束：CHECK  

3. 实体（行）级约束

   > 对比同一表中其他行数据

   主键约束：PRIMARY KEY  

   唯一约束:UNIQUE

   自增长约束：AUTO_INCREMENT  只能添加到键列（主键，唯一），普通不可以 ；一张表只能有一个自增长约束；类型必须是整数；

4. 引用（多表）级约束

   > 对比其他表的列

   外键约束：FOREIGN KEY

**主键约束**

**主键细节**：每个表只能有一个主键  、复合主键(单个列或多个列构成) 、主键列类型任意 、主键索引PRIMARY（创建主键约束时自动建立，删除主键约束，一起消失；能够根据主键查询的，就根据主键索引查询，效率更高）

主键：确保行数据不重复的列，主键列应该唯一且不能为空

主键约束：针对主键列的数据约束和限制，确保主键列不会出现错误数据（保证唯一且不能为空）

  主键是数据设计中的一个概念，用于唯一标识记录，而主键约束是实现这一概念的技术手段，确保数据库系统遵守这一规则。

**外键约束**

外键：引用或参照其他表主键值的列，我们称为外键，外键的值范围应当引用主键的值范围

外键约束：外键应该引用主键的值，但是如果不添加约束，可能会出现错误数据，例如：MySQL数据，外键约束确保，外键必须且正确引用主键的值的限制！

**外键细节**: 可以多个外键、外键是跨表引用其他表的主键（被引用为主表，外键表是子表）、类型不任意与主键类型对应，尽力命名相同；注意删除；

存在主外键关系（外键约束），删除主表数据时,可能会因为子表引用而删除失败。可以先删除子表的所有引用数据再删除!

![image-20240828094225059](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20240828094225059.png)

```
ON DELETE CASCADE ON UPDATE CASCADE;  #cascade 连级 
```

**面试题**

**建和不建外键约束有什么区别？**

建外键约束，操作受限，语法层面讲；在员工表中不可能添加一个员工信息，它的部门的值在部门表中找不到。

不建立外键约束，操作不受限，你能添加一个员工的信息，它的部门指定为一个完全不存在的部门。

> 操作：创建表、删除表、添加、修改、删除

**建和不建外键约束对查询有什么影响？**

没有

添加约束可能影响查询速度和效率！

**表中字段为什么不想要 null 的值？**

（1）不好比较。null是一种特殊值，比较时只能用专门的is null 和 is not null来比较。碰到运算符，通常返回null（null*任何=null）。

（2）效率不高。影响提高索引效果。因此，我们往往在建表时 not null default '' 或 default 0

**带AUTO_INCREMENT约束的字段值是从1开始的吗？**

在MySQL中，默认AUTO_INCREMENT的初始值是1，每新增一条记录，字段值自动加1。

设置自增属性（AUTO_INCREMENT）的时候，还可以指定第一条插入记录的自增字段的值，这样新插入的记录的自增字段值从初始值开始递增，如在表中插入第一条记录，同时指定id值为5，则以后插入的记录的id值就会从6开始往上增加。添加主键约束时，往往需要设置字段自动增加属性。

除此之外，可以在创建表的时候，指定自增长起始值，

**是不是每个表都可以任意选择存储引擎?**

答：外键约束（FOREIGN KEY）不能跨引擎使用。

MySQL支持多种存储引擎，每一个表都可以指定一个不同的存储引擎，需要注意的是：外键约束是用来**保证数据的参照完整性**的，如果表之间需要关联外键，却指定了不同的存储引擎，那么这些表之间是不能创建外键约束的。所以说，存储引擎的选择也不完全是随意的。

**请问你会不会创建数据库时给你的表添加完备的约束呢****？**

答: 不会，一般情况下，我们只会添加一些单表的约束（实体约束和域约束）！

   不会添加外键和级联操作！

   根据阿里开发规范，【强制】不得使用外键与级联，一切外键概念必须在应用层解决。 

 （概念解释）学生表中的 student_id 是主键，那么成绩表中的 student_id 则为外键。如果更新学生表中的 student_id，同时触发成绩表中的 student_id 更新，即为级联更新。外键与级联更新**适用于单机低并发**，不适合分布式、高并发集群；级联更新是强阻塞，存在数据库更新风暴的风险；**外键影响数据库的插入速度**。